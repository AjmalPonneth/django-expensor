{% extends "base.html" %}
{% load crispy_forms_tags %}


{% block body %}

<div class="row">

  <div class="ui-widget col-sm-12 col-md-6 col-lg-6">

    <form method="post" id="id_add_income" action="">
      {% csrf_token %}
      {{ income_form|crispy }}
      <input type="submit" class="btn btn-success btn-block" value="{{ title }}">
    </form>
  </div>

</div>

<br>
<div class="row">
<div class="col-sm-12 col-md-6 col-lg-6">
  <p id="id_success" class="alert alert-success" style="display:none;">Income added</p>
  <p id="id_error" class="alert alert-danger" style="display:none;">Some error has occured. Failed to save.</p>
</div>
</div>




{% endblock %}



{% block js %}
<script type="text/javascript">
  $(document).ready(function(){

    $("#id_source").autocomplete({
      source: "{% url 'income:get-source' %}",
    });

    $("#id_timestamp").datepicker();

    document.getElementById('id_amount').onkeyup = function () {
        document.getElementById('hint_id_amount').innerHTML = inWords(document.getElementById('id_amount').value);
    };

    var form = $("#id_add_income");

    form.submit(function(){
      $.ajax({
        type: form.attr('method'),
        url: form.attr('action'),
        data: form.serialize(),
        success: function(data){
          document.getElementById('hint_id_amount').innerHTML = "";
          form[0].reset();

          $("#id_error").css("display", "none");
          $("#id_success").css("display", "inline-block");

          window.location = "{% url 'income:income-list' %}";
        },
        error: function(data){
          $("#id_success").css("display", "none");
          $("#id_error").css("display", "inline-block");
        }
      });
      return false;
    });
  });


</script>
{% endblock js %}
